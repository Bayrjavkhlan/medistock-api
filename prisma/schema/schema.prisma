generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?

  roles Role[]

  hospital Hospital?     @relation(fields: [hospitalId], references: [id])
  hospitalId String?

  equipmentsAssigned Equipment[] @relation("AssignedEquipment")

  equipmentLogs EquipmentLog[] @relation("PerformedLogs")

  createdBy String?
  updatedBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Role {
  id   String       @id @default(uuid())
  key  EnumUserRole @unique
  name String

  users User[]
}

model Hospital {
  id String @id @default(uuid())
  name String
  phoneNumber String?
  email String?

  address  Address?
  users User[]

  equipments Equipment[]

  createdBy String?
  updatedBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Equipment {
  id          String   @id @default(uuid())
  name        String
  serialNo    String   @unique

  hospital    Hospital @relation(fields: [hospitalId], references: [id])
  hospitalId  String

  assignedTo  User?    @relation("AssignedEquipment", fields: [userId], references: [id])
  userId      String?

  category    EquipmentCategory
  logs        EquipmentLog[]

  state       EquipmentState

  createdBy String?
  updatedBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EquipmentLog {
  id          String   @id @default(uuid())
  equipment   Equipment @relation(fields: [equipmentId], references: [id])
  equipmentId String

  performedBy User     @relation("PerformedLogs", fields: [userId], references: [id])
  userId      String

  createdBy String?
  updatedBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Address {
  id String @id @default(uuid())
  address1 String
  address2 String?
  province String

  hospital   Hospital? @relation(fields: [hospitalId], references: [id])
  hospitalId String? @unique

  createdBy String?
  updatedBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ===== ENUMS =====
enum EnumUserRole {
  ADMIN
  HOSPITAL_ADMIN
  STAFF
}

enum EquipmentCategory {
  IMAGING_MRI
  IMAGING_CT
  IMAGING_X_RAY
  IMAGING_ULTRASOUND
  VENTILATOR
  PATIENT_MONITOR
  SURGICAL_INSTRUMENT
  LAB_EQUIPMENT
  INFUSION_PUMP
  DEFIBRILLATOR
  DIALYSIS_MACHINE
  OTHER
}

enum EquipmentState {
  AVAILABLE       
  ASSIGNED        
  IN_MAINTENANCE  
  OUT_OF_ORDER    
  RETIRED         
}
